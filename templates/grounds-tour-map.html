{% extends 'base.html' %}
{% block content %}
{% load static %}

<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>

<style>

    .mepkinmap {
        width: 100%;
        position: relative;
        overflow: hidden; /* Ensure pins stay within the container */
        border-radius: 20px;
    }

    .mepkinmap img {
        width: 100%;
        height: auto;
        object-fit: contain;
    }

    .title {
        text-align: center;
        color: #fff;
        margin: 2em 0;
        padding: 0 1em;
    }

    .title p {
        max-width: 500px;
        margin: 1em auto;
        line-height: 27px;
    }

    .pin {
        background: #4362f8;
        position: absolute;
        width: 0.7em;
        height: 0.7em;
        border-radius: 50%;
        transform: translate(-50%, -50%);
    }

    .pin.Gold:before {
        content: '';
        background: #FFD700;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 100%;
        height: 100%;
        border-radius: 50%;
        animation: pulse 1.3s ease-in-out infinite;
    }



    .pin.Blue:before {
        background: #3380FF; /* Blue color - spiritual */
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 100%;
        height: 100%;
        border-radius: 50%;
        animation: pulse 1.3s ease-in-out infinite;
    }

    .pin.Green:before {
        background: #33FF57; /* Green color - historical and spiritual */
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 100%;
        height: 100%;
        border-radius: 50%;
        animation: pulse 1.3s ease-in-out infinite;
    }

    .pin.Red:before {
        background: #FF5733; /* Red color - general */
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 100%;
        height: 100%;
        border-radius: 50%;
        animation: pulse 1.3s ease-in-out infinite;
    }

    .pin span {
        display: inline-block;
        white-space: nowrap;
        position: absolute;
        left: 2.5em;
        top: 50%;
        transform: translateY(-50%);
        background: #fff;
        border-radius: 10px; /* Adjust border-radius for curved corners */
        padding: 0.3em 0.6em;
        font-size: 5px;
        max-width: 150px; /* Adjust the maximum width as needed */
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: normal;
        text-align: center;
        line-height: 1.2;
        box-shadow: 0 0 3px rgba(0, 0, 0, 0.2);
        text-transform: uppercase;
    }

    .LuceGardens {
        top: 38%;
        left: 33%;
    }

    .AbbeyChurch {
        top: 83%;
        left: 43%;
    }

    .StClareWalkway {
        top: 58%;
        left: 55%;
    }

    .ReceptionCenterGiftShop {
        top: 55.2%;
        left: 61.5%;
    }

    .MemorialGarden {
        top: 58%;
        left: 68%;
    }

    .FiremansMemorial {
        top: 34.3%;
        left: 78.9%;
    }

    .Labyrinth {
        top: 26%;
        left: 68.5%;
    }

    .CrossroadsSacredHeart {
        top: 29%;
        left: 55%;
    }


    .MepkinAbbeyColumbarium {
        top: 43%;
        left: 12%;
    }

    .JohnLaurensGraveCemetery {
        top: 31%;
        left: 5%;
    }

    .MeditationGarden {
        top: 27%;
        left: 15%;
    }

    .AfricanAmericanCemetery {
        top: 90.3%;
        left: 78.8%;
    }

    .OfficesPrivateRooms {
        top: 80%;
        left: 52.2%;
    }

    .FlighttoEgyptCrucifixion {
        top: 32.5%;
        left: 21%;
    }




</style>

<div class="bg-secondary text-white">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center py-2">
            <h1>
                <span class="me-4">
                    <a href="{% url 'virtual-tour' %}" class="text-decoration-none text-white">
                        <i class="fa-solid fa-arrow-left"></i>
                    </a>
                </span>
                Maps
            </h1>
            <img src="{% static 'MEPKING/logo.png' %}" height="75rem" alt="">
        </div>
    </div>
</div>

<div class="container mt-3">


    <div class="mepkinmap">
        <img src="{% static 'MEPKING/Mepkin Abbey Map.png' %}" alt="...">

        <div class="pin Blue AbbeyChurch" onclick="window.location.href='{% url 'mepkin-abbey-church' %}';">
            <span>Mepkin Abbey Church</span>
        </div>

        <div class="pin Gold StClareWalkway" onclick="window.location.href='{% url 'st-claire-walkway' %}';">
            <span>St. Claire Walkway</span>
        </div>

        <div class="pin Red ReceptionCenterGiftShop"
             onclick="window.location.href='{% url 'reception-center-or-gift-shop' %}';">
            <span>Reception Center / Gift Shop</span>
        </div>

        <div class="pin Spiritual MemorialGarden" onclick="window.location.href='{% url 'memorial-garden' %}';">
            <span>Memorial Garden</span>
        </div>

        <div class="pin Green FiremansMemorial"
             onclick="window.location.href='{% url 'charleston-firefighters-memorial' %}';">
            <span>Charleston Firefighters Memorial</span>
        </div>

        <div class="pin Blue Labyrinth" onclick="window.location.href='{% url 'labyrinth' %}';">
            <span>Labyrinth</span>
        </div>

        <div class="pin Blue CrossroadsSacredHeart"
             onclick="window.location.href='{% url 'crossroads-or-sacred-heart-of-jesus-statue' %}';">
            <span>Crossroads / Sacred Heart of Jesus Statue</span>
        </div>

        <div class="pin Gold LuceGardens" onclick="window.location.href='{% url 'luce-gardens' %}';">
            <span>Luce Gardens</span>
        </div>

        <div class="pin Blue MepkinAbbeyColumbarium"
             onclick="window.location.href='{% url 'mepkin-abbey-columbarium' %}';">
            <span>Mepkin Abbey Columbarium</span>
        </div>

        <div class="pin Green JohnLaurensGraveCemetery"
             onclick="window.location.href='{% url 'john-laurens-grave-or-cemetery' %}';">
            <span>Laurens Cemetery</span>
        </div>

        <div class="pin Green MeditationGarden"
             onclick="window.location.href='{% url 'meditation-garden-of-truth-and-reconciliation' %}';">
            <span>Meditation Garden of Truth & Reconciliation</span>
        </div>

        <div class="pin Gold AfricanAmericanCemetery"
             onclick="window.location.href='{% url 'african-american-cemetery' %}';">
            <span>African-American Cemetery</span>
        </div>

        <div class="pin Red OfficesPrivateRooms"
             onclick="window.location.href='{% url 'offices-and-private-rooms' %}';">
            <span>Offices and Private Rooms</span>
        </div>

        <div class="pin Blue FlighttoEgyptCrucifixion" onclick="window.location.href='#';">
            <span>The Flight to Egypt Crucifixion</span>
        </div>
    </div>

    <div class="d-flex justify-content-center">
        <ul class="my-3">
            <li class="my-1">For the <span class="fw-bold">Historical Sites</span> click on the <span
                    style="background-color: #FFD700;">Gold</span> pin
            </li>
            <li class="my-1">For the <span class="fw-bold">Spiritual Sites</span> click on the <span
                    style="background-color: #0000FF;">Blue</span> pin
            </li>
            <li class="my-1">For the <span class="fw-bold">Historical and Spiritual Sites</span> click on the <span
                    style="background-color: #00FF00;">Green</span> pin
            </li>
            <li class="my-1">For the <span class="fw-bold">General</span> click on the <span
                    style="background-color: #FF0000;">Red</span> pin
            </li>
        </ul>
    </div>

    <!-- Responsive map container using Bootstrap classes -->
    <div id="map" class="mb-4" style="height: 400px;"></div>

</div>
<br>
{% include 'navbar.html' %}

<script>
    function initMap() {
        // Initialize the map centered at the user's current location
        var map = new google.maps.Map(document.getElementById('map'), {
            center: { lat: 0, lng: 0 }, // Initial placeholder, will be updated with the user's location
            zoom: 17,
        });

        // Get the user's current location
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function (position) {
                var userPosition = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };

                // Update the map center to the user's current location
                map.setCenter(userPosition);

                // Create a marker for the user's current location
                var userMarker = new google.maps.Marker({
                    position: userPosition,
                    map: map,
                    title: 'Your Location'
                });

                // Create a marker
                var markerPosition = { lat: 33.1160651, lng: -79.9442717 };
                var marker = new google.maps.Marker({
                    position: markerPosition,
                    map: map,
                    title: 'Mepkin Abbey Church',
                });

                // Display directions from the user's location to Mepkin Abbey
                var directionsService = new google.maps.DirectionsService();
                var directionsRenderer = new google.maps.DirectionsRenderer({
                    map: map,
                    suppressMarkers: true  // Do not display default markers
                });

                var request = {
                    origin: userPosition,
                    destination: new google.maps.LatLng(markerPosition.lat, markerPosition.lng),
                    travelMode: 'DRIVING'
                };

                directionsService.route(request, function (result, status) {
                    if (status == 'OK') {
                        directionsRenderer.setDirections(result);
                    } else {
                        console.error('Directions request failed with status: ' + status);
                    }
                });
            }, function () {
                // Handle geolocation error
                console.error('Error: The Geolocation service failed.');
                alert('Please enable location services to use this feature.');
            });
        } else {
            // Browser doesn't support geolocation
            console.error('Error: Your browser doesn\'t support geolocation.');
            alert('Your browser does not support geolocation. Please use a different browser or enable location services.');
        }
    }

    initMap();
</script>


{% endblock %}