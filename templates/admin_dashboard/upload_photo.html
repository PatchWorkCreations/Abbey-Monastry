{% extends 'admin_dashboard/admin_base.html' %}

{% block content %}
<h1>Upload or Change Photos</h1>
<p>Use this form to upload new photos for different sections.</p>
<form method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
    {% csrf_token %}
    <div class="mb-3">
        <label for="section" class="form-label">Select Section:</label>
        <select id="section" name="section" class="form-select" required>
            <option value="francis_artwork">Francis Artwork</option>
            <option value="other_section">Other Section</option>
            <!-- Add more options as needed -->
        </select>
        <div class="invalid-feedback">
            Please select a section.
        </div>
    </div>
    <div class="mb-3">
        <label for="start_date" class="form-label">Start Date: Please Check the covered dates before choosing from the date picker</label>
        <input type="date" id="start_date" name="start_date" class="form-control" required>
        <div class="invalid-feedback">
            Please choose a start date.
        </div>
    </div>
    <div class="mb-3">
        <label for="num_days" class="form-label">Number of Days:</label>
        <input type="number" id="num_days" name="num_days" class="form-control" min="1" max="365" required>
        <div class="invalid-feedback">
            Please enter a valid number of days.
        </div>
    </div>
    <div class="mb-3">
        <label for="photos" class="form-label">Choose photos:</label>
        <input type="file" id="photos" name="photos" class="form-control" accept="image/*" multiple required>
        <div class="invalid-feedback">
            Please choose photos to upload.
        </div>
    </div>
    <button type="submit" class="btn btn-primary">Upload</button>
</form>

<h2>Covered Future Dates</h2>
<ul id="covered-dates-list" class="list-group">
    {% for date in covered_dates %}
    <li class="list-group-item">{{ date }}</li>
    {% endfor %}
</ul>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const coveredDates = JSON.parse('{{ covered_dates|escapejs }}');
        const coveredDatesSet = new Set(coveredDates);

        const dateInput = document.getElementById('start_date');

        dateInput.addEventListener('change', function() {
            const selectedDate = dateInput.value;
            if (coveredDatesSet.has(selectedDate)) {
                alert('This date is already covered. Please choose another date.');
                dateInput.value = '';  // Clear the input
            }
        });

        // Bootstrap validation
        const forms = document.querySelectorAll('.needs-validation');
        Array.prototype.slice.call(forms).forEach(function(form) {
            form.addEventListener('submit', function(event) {
                if (!form.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            }, false);
        });
    });
</script>
{% endblock %}
