{% extends 'base.html' %}
{% block content %}
{% load static %}

<style>
    body {
        background-image: url('{% static 'MEPKING/Prayer Request.jpg' %}');
        background-size: cover;
    }

    .overlay {
        background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent background */
        padding: 20px;
        border-radius: 10px;
    }

    .form-control, .form-select {
        background-color: rgba(255, 255, 255, 0.9); /* Adjusted opacity */
    }

    .form-container {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh; /* Full viewport height */
    }

    .form-content {
        width: 100%;
        max-width: 500px; /* Maximum width for the form */
    }
</style>

<div class="bg-secondary text-white sticky-top">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center py-2">
            <h1>
                <span class="me-4">
                    <a href="{% url 'home' %}" class="text-decoration-none text-white">
                        <i class="fa-solid fa-arrow-left"></i>
                    </a>
                </span>
                Submit a Prayer Request
            </h1>
            <img src="{% static 'MEPKING/logo.png' %}" height="75rem" alt="Mepkin Abbey Logo">
        </div>
    </div>
</div>

<div class="container form-container">
    <div class="form-content overlay text-white">
        <p>At Mepkin Abbey, we believe in the power of prayer. Share your petitions and gratitude with us, and let us join you in your spiritual journey. Submit your prayer requests below and know that we are here to support you.</p>

        {% if message %}
        <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
            <symbol id="check-circle-fill" fill="currentColor" viewBox="0 0 16 16">
                <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
            </symbol>
        </svg>

        <div class="alert alert-success d-flex align-items-center alert-dismissible fade show" role="alert">
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Success:">
                <use xlink:href="#check-circle-fill"/>
            </svg>
            <div>
                {{ message|safe }}
            </div>
        </div>
        {% endif %}

        <form method="post">
            {% csrf_token %}
            <div class="mb-3">
                <label class="form-label">Name/Pseudonym:</label>
                <input type="text" class="form-control" name="name" placeholder="Enter name..." required>
            </div>
            <div class="mb-3">
                <label class="form-label">Petition or Gratitude:</label>
                <select class="form-select" name="type" required>
                    <option value="">---</option>
                    <option value="Prayer Request">Petition</option>
                    <option value="Gratitude Prayer">Gratitude</option>
                </select>
            </div>
            <div class="mb-3">
                <label class="form-label">Prayer Message:</label>
                <textarea class="form-control" name="prayer_msg" id="prayer_msg" rows="3" placeholder="Type your prayer here..." required></textarea>
                <p class="text-end mt-1" id="wordCount" style="font-size: 12px;">200 words remaining</p>
            </div>
            <div class="d-grid gap-2">
                <button class="btn btn-secondary" type="submit" name="pray">Submit</button>
                <a href="#" class="text-center text-decoration-none login-as-administrator-btn">Login as Administrator</a>
            </div>
        </form>

        <div class="w-100 p-2 d-none login-card">
            <form method="post">
                {% csrf_token %}
                <div class="mb-3">
                    <label class="form-label">Username:</label>
                    <input type="text" class="form-control" name="username" placeholder="Enter username..." required>
                </div>
                <div class="mb-3">
                    <label class="form-label">Password:</label>
                    <input type="password" class="form-control" name="password" placeholder="Enter password..." required>
                </div>
                <div class="d-grid gap-2">
                    <button class="btn btn-secondary" type="submit" name="admin_login">Login</button>
                    <a href="#" class="text-center text-decoration-none send-prayer-btn">Go back to Prayer Request</a>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        var sendPrayerCard = document.querySelector(".send-prayer-card");
        var loginCard = document.querySelector(".login-card");
        var loginButton = document.querySelector(".login-as-administrator-btn");
        var sendPrayerButton = document.querySelector(".send-prayer-btn");

        loginButton.addEventListener("click", function(event) {
            sendPrayerCard.classList.toggle("d-none");
            loginCard.classList.toggle("d-none");
            event.preventDefault();
        });

        sendPrayerButton.addEventListener("click", function(event) {
            loginCard.classList.toggle("d-none");
            sendPrayerCard.classList.toggle("d-none");
            event.preventDefault();
        });
    });

    var textarea = document.getElementById('prayer_msg');
    var wordCountDisplay = document.getElementById('wordCount');

    textarea.addEventListener('input', function () {
        var words = textarea.value.split(/\s+/).filter(function (word) {
            return word.length > 0;
        });
        var wordCount = words.length;

        if (wordCount > 200) {
            var truncatedWords = words.slice(0, 200);
            textarea.value = truncatedWords.join(' ');
            wordCount = 200;
        }

        var remainingWords = 200 - wordCount;
        wordCountDisplay.textContent = remainingWords + (remainingWords === 1 ? ' word' : ' words') + ' remaining';
    });
</script>
<br>
<br>
<br>
{% include 'navbar.html' %}
{% endblock %}
